{% extends "base.html" %}

{% block title %}DICI{% endblock title%}

{% block content %}
<div class="bg-white p-6 rounded-lg shadow-lg">
    <h2 class="text-2xl font-semibold mb-4">Gerenciar DICI</h2>
        <div>
            <form id="dici-form" hx-post="/financeiro/generate_dici" hx-target="#dici-result" hx-swap="outerHTML">
                <div class="mb-4">
                    <label for="reference_date" class="block text-gray-700">Data de Referencia:</label>
                    <select id="reference_date" name="reference_date" class="form-select mt-1 block w-full">
                        {% for date in reference_date %}
                        <option value="{{ date }}">{{ date }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="flex justify-end">
                    <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded-lg">Gerar DICI</button>
                </div>
            </form>
        </div>
</div>

<div id="dici-result" class="mt-6">
    <div class="bg-white p-6 rounded-lg shadow-lg">
        <h3 class="text-2xl font-semibold mb-4">DICI Gerados</h3>
            <table class="min-w-full table-auto">
                <thead class="bg-gray-200">
                    <tr>
                        <th class="px-4 py-2">Referência</th>
                        <th class="px-4 py-2">Data</th>
                        <th class="px-4 py-2">Ações</th>
                    </tr>
                </thead>

                <tbody>
                    {% for dici in dicis %}
                    <tr>
                        <td class="border px-4 py-2">{{ dici.reference_date }}</td>
                        <!--BUG nao sei se is defined ira considerar NONE como nao definido-->
                        {% if dici.created_at %}
                            <td class="border px-4 py-2">{{ dici.created_at }}</td>
                        {% endif %}

                        <td class="border px-4 py-2">
                            <!--TODO use htmx for downloading dici-->
                            <a href="/financeiro/dici/download/{{ dici.id }}" class="text-blue-500 hover:underline">Download</a>
                            <button hx-delete="/financeiro/dici/delete/{{ dici.id }}" hx-target="closest tr" class="text-red-500 hover:underline ml-4">Delete</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock content %}
